<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Botiga</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script>
        $(document).ready(function(){
            function getProducts(){
                $.get("http://localhost:8080/dsaApp/store/getStoreProducts", function(data, status) {
                    // Limpiar la tabla de productos
                    $("#ProductosTienda tbody").empty();
                    // Recorrer la lista de productos y agregar cada uno a la tabla
                    data.forEach(function (item) {
                        // Crear un elemento de imagen con la URL del ítem
                        var img = $("<img>").attr("src", item.imatge).attr("alt", "Imatge de l'ítem");
                        // Creem una fila de la taula y omplim les celdas amb la info dels get
                        var row = $("<tr>").append(
                            $("<td>").text(item.name),
                            $("<td>").text(item.idProduct),
                            $("<td>").text(item.description),
                            $("<td>").text(item.price),
                            $("<td>").append(img) // Agreguem la imatge
                        );
                        // Agreguem la fila creada a la taula
                        $("#ProductosTienda tbody").append(row);
                    });
                });
            }
            $('#buttonMostrar').click(function() {
                getProducts();
            });
            $('#buttonGuardar').click(function () {
                var idProduct = $('#idProduct').val();
                var name = $('#nameProduct').val();
                var description = $('#descriptionProduct').val();
                var price = $('#priceProduct').val();

                var productData = {
                    idProduct: $('#idProduct').val(),
                    name: $('#nameProduct').val(),
                    description: $('#descriptionProduct').val(),
                    price: $('#priceProduct').val(),
                    imatge: $('imatgeProduct').val()
                };

                var URL = "dsaApp/store/addProduct";
                $.post({
                    url: URL,
                    data: JSON.stringify(productData),
                    contentType: 'application/json; charset=utf-8'
                })
                    .done(function (data, status) {
                        alert("Producte afegit correctament");
                        getProducts();
                    })
                    .fail(function (xhr, err) {
                        alert("El producte ja existeix");
                        location.reload();
                    })

            })
            $('#buttonDelete').click(function () {
                var idProduct = $('#idProductDel').val();
                var URL = "dsaApp/store/deleteProduct/" + idProduct;
                $.ajax({
                    type: "DELETE",
                    url: URL,
                })
                    .done(function (data, status) {

                        alert("Producte esborrat correctament");
                        getProducts();

                    })
                    .fail(function (xhr, err) {
                        alert("El producte no existeix");
                        location.reload();
                    })
            })
        });

    </script>

    <style>
        body {
            .container {
                text-align: center; /*Centra botons*/
            }

            .btn {
                margin: 20px; /*Agrega espai entre botons*/
            }

            .table {
                text-align: left;
            }

            background-image: url('galaxia2.jpg');

        }

    </style>
</head>


<body>
<div class="jumbotron bg-dark text-center">
    <h1 style="color:lightcyan"><b>Botiga</b></h1>
</div>
<div class="container p-3 my-3 bg-light text-dark">
    <div class="row">

        <h1>Productes</h1>

        <table class="table table-light table-striped table borderless" id="ProductosTienda">
            <thead>

            <tr>
                <th>Nom</th>
                <th>ID</th>
                <th>Descripción</th>
                <th>Preu</th>
                <th>Comprar</th>

            </tr>

            </thead>
            <tbody>
            </tbody>
        </table>
    </div>


    <!--Boto ADD-->
    <button type="buttonAdd" class="btn btn-dark" data-toggle="modal" data-target="#myModal">Afegir Producte</button>

    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">

                <div class="modal-header">
                    <h4 class="modal-title">Afegir Producte</h4>
                    <button type="button" class="close text-danger" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <p>Nom: <input type="text" id="nameProduct"></p>
                    <p>Id: <input type="text" id="idProduct"></p>
                    <p>Descripció: <input type="text" id="descriptionProduct"></p>
                    <p>Preu: <input type="text" id="priceProduct"></p>
                    <p>Imatge: <input type="text" id="imatgeProduct"></p>
                    <button id="buttonGuardar" class="btn btn-light" data-dismiss="modal" onClick="addProduct">Guardar</button>

                </div>
            </div>
        </div>
    </div>

    <!--Boto DELETE-->
    <button type="buttonDelete" class="btn btn-dark" data-toggle="modal" data-target="#myModalDel">Borrar Producte</button>

    <div class="modal fade" id="myModalDel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">

                <div class="modal-header">
                    <h4 class="modal-title">Borrar Producte</h4>
                    <button type="button" class="close text-danger" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <p>ID: <input type="text" id="idProductDel"></p>
                    <button id="buttonDelete" class="btn btn-light" data-dismiss="modal" onclick="deleteP">Borrar</button>

                </div>
            </div>
        </div>
    </div>
    <!--Boto -->
    <button id="buttonMostrar" type="buttonMostrar" class="btn btn-dark" data-toggle="modal" data-target="#myModalProducts">Llista Producte</button>

    <div class="modal fade" id="myModalProduct">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">

                <div class="modal-header">
                    <h4 class="modal-title">Mostrar Producte</h4>
                    <button type="button" class="close text-danger" data-dismiss="modal" onclick="getProducts">&times;</button>
                </div>

            </div>
        </div>
    </div>


</div>
<div class="col-sm-4"></div>

</body>
</html>